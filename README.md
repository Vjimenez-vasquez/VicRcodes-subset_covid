# VicRCodes - subset_covid 

This code was designed by Victor Jimenez Vasquez - vr.jimenez.vs@gmail.com.
## Intro
Modern pandemic COVID-19 is currently studied at the molecular level by the genomic surveillance of its ethiological agent: SARS-CoV-2. Many institutions around the world has generated thousands of SARS-CoV-2 genomes and most of them have been deposited in free data-bases like GISAID. The understanding of the evolution of SARS-CoV-2 requires the application of epidemiological, phylogenetic, phylodynamic analyses and so on. The huge amount of genomic information makes untractable many local and fast analysis, moreover there's an asymetric generation of the genomic information: some countries upload hundreds of genomes per epidemiological week while some others no more than tens. 
"subset_covid" allows the user to generate a subset  from an original metadata downloaded or compiled from GISAID (https://www.gisaid.org/) based on epidemiological week and country. "subset_covid" extract a percentage of samples above a minimum frequency threshold for all epidemiological weeks and for all countries included in your data. "subset_covid" retains all genomes by epidemiological week and country if those does not exced a minimum frequency threshold, otherwise it extracts only a percentage. 

## Usage 
```r

# "subset_covid" requires lubridate R library #
install.packages("lubridate")
library(lubridate)

#paste "subset_covid.R" file in your working directory#
source("subset_covid.R")

# read metadata, in this example we have two metadata files downloaded from GISAID #
a <- read.csv("metadata_1.tsv", header=TRUE, sep="\t")
b <- read.csv("metadata_2.tsv", header=TRUE, sep="\t")
data <- rbind(a,b)

# run "subset_covid" #
res <- subset_covid(data=data,minfreq=5,proportion=0.1,year=2021,label="omicron_22")
res

# "subset_covid" arguments #
- data = metadata prepared from GISAID
- minfreq = minimum genome frequency threshold. Indicates the maximum number of genomes sampled in a given country by epidemiological week that will not be afected by a proportional extraction. For example, if we set this value to 5, imagine Peru has only 5 genomes in the epidemogical week number 40, thus the 100% of genomes (5) will be considered in the subset, but in the alternative case that Peru has more than 5 genomes thus only a specified percentage (proportion argument) of this genomes will be randomly sampled. 
- proportion = proportion of samples to extract if the number of genomes by a given country in a given epidemiological week exceds the minimum genome frequency threshold (minfreq). For example, if Peru contains 100 genomes in the epidemiological week number 40 and if we set this value to 0.1, thus 10 genomes will be randomly sampled.  
- year = the year of interest 
- label = a name to include in the output files. For example "delta", "omicron_2022". 

```
## Output 

"subset_covid" will generate 4 files in ".csv" format. Examples, if we use "omicron_22" in "label" argument: 

- original_frequencies_omicron_22.csv
- filtered_frequencies_omicron_22.csv
- filtered_table_omicron_22.csv
- gisaid_epi_isl_omicron_22.csv

This files indicate a list of sampled gisaid accession codes 
(gisaid_epi_isl_omicron_22.csv), a frequency table for all samples represented by epidemiological week for every country (original_frequencies_omicron_22.csv), a frequency table  generated by the program containing all genomes (if they equals or do not exceds the "minfreq" value) or a percentage of genomes (specified in "proportion") by epidemiological week for every country,  a reduced metadata (filtered_table_omicron_22.csv) corresponding only to the sampled gisaid accession codes. 

## Utility 

Use "subset_covid" to generate a reduced and representative data for epidemiological or phylogenetic analysis or in cases of limiting computational resources. 

This code was designed by Victor Jimenez Vasquez - vr.jimenez.vs@gmail.com.

Vic

